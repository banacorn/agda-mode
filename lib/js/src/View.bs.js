// Generated by BUCKLESCRIPT, PLEASE EDIT WITH CARE
'use strict';

var Atom = require("atom");
var Curry = require("bs-platform/lib/js/curry.js");
var React = require("react");
var ReactDom = require("react-dom");
var Belt_Array = require("bs-platform/lib/js/belt_Array.js");
var Caml_option = require("bs-platform/lib/js/caml_option.js");
var Event$AgdaModeVscode = require("agda-mode-vscode/lib/js/src/Util/Event.bs.js");
var Panel$AgdaModeVscode = require("agda-mode-vscode/lib/js/src/View/Panel.bs.js");
var Webapi__Dom__HtmlElement = require("bs-webapi/lib/js/src/Webapi/Webapi__Dom/Webapi__Dom__HtmlElement.js");

function make(param) {
  var containers = Belt_Array.keep(Belt_Array.concatMany(Belt_Array.map(Belt_Array.map(atom.workspace.getBottomPanels(), (function (prim) {
                      return atom.views.getView(prim);
                    })), (function (xs) {
                  return Belt_Array.keepMap(Array.prototype.slice.call(xs.childNodes), Webapi__Dom__HtmlElement.ofNode);
                }))), (function (elem) {
          return elem.className === "agda-mode-panel-container";
        }));
  var container = Belt_Array.get(containers, 0);
  if (container !== undefined) {
    return Caml_option.valFromOption(container);
  } else {
    var panelContainer = document.createElement("article");
    panelContainer.classList.add("agda-mode-panel-container");
    atom.workspace.addBottomPanel({
          item: panelContainer,
          priority: 0,
          visible: true
        });
    return panelContainer;
  }
}

function add(container, element) {
  container.appendChild(element);
  
}

var PanelContainer = {
  make: make,
  add: add
};

function send(view, request) {
  Curry._1(view.onRequest.emit, request);
  return Curry._1(view.onResponse.once, undefined);
}

function on(view, callback) {
  view.subscriptions.push(Curry._1(view.onResponse.on, (function ($$event) {
              if (typeof $$event === "number" || $$event.tag !== /* Event */1) {
                return ;
              } else {
                return Curry._1(callback, $$event[0]);
              }
            })));
  return new Atom.Disposable((function (param) {
                
              }));
}

function show(view) {
  send(view, /* Show */0);
  
}

function focus(_view) {
  
}

function hide(view) {
  send(view, /* Hide */1);
  
}

function make$1(_context, editor) {
  var onRequest = Event$AgdaModeVscode.make(undefined);
  var onResponse = Event$AgdaModeVscode.make(undefined);
  var container = make(undefined);
  atom.views.getView(editor).classList.add("agda-mode");
  var element = document.createElement("article");
  element.setAttribute("tabIndex", "-1");
  element.classList.add("agda-mode-panel");
  element.classList.add("native-key-bindings");
  container.appendChild(element);
  ReactDom.render(React.createElement(Panel$AgdaModeVscode.make, {
            onRequest: onRequest,
            onResponse: onResponse
          }), element);
  var view_subscriptions = [];
  var view = {
    editor: editor,
    element: element,
    subscriptions: view_subscriptions,
    onRequest: onRequest,
    onResponse: onResponse
  };
  send(view, /* Show */0);
  return view;
}

function destroy(view) {
  ReactDom.unmountComponentAtNode(view.element);
  view.element.remove();
  atom.views.getView(view.editor).classList.remove("agda-mode");
  return Belt_Array.forEach(view.subscriptions, (function (destructor) {
                return Curry._1(destructor, undefined);
              }));
}

exports.PanelContainer = PanelContainer;
exports.send = send;
exports.on = on;
exports.show = show;
exports.focus = focus;
exports.hide = hide;
exports.make = make$1;
exports.destroy = destroy;
/* atom Not a pure module */
