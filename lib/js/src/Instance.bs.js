// Generated by BUCKLESCRIPT, PLEASE EDIT WITH CARE
'use strict';

var Curry = require("bs-platform/lib/js/curry.js");
var $$Promise = require("reason-promise/lib/js/src/js/promise.js");
var Root$AgdaMode = require("./View/Root.bs.js");
var Event$AgdaMode = require("./Util/Event.bs.js");
var Editors$AgdaMode = require("./Editors.bs.js");
var TaskRunner$AgdaMode = require("./Task/TaskRunner.bs.js");
var RunningInfo$AgdaMode = require("./RunningInfo.bs.js");

function activate(instance) {
  if (instance.isLoaded) {
    return Curry._1(instance.view.activate, undefined);
  } else {
    return $$Promise.resolved(undefined);
  }
}

function deactivate(instance) {
  if (instance.isLoaded) {
    return Curry._1(instance.view.deactivate, undefined);
  } else {
    return $$Promise.resolved(undefined);
  }
}

function destroy(instance) {
  return Curry._1(instance.view.destroy, undefined);
}

function make(textEditor) {
  atom.views.getView(textEditor).classList.add("agda");
  var editors = Editors$AgdaMode.make(textEditor);
  var view = Root$AgdaMode.initialize(editors);
  var instance = {
    editors: editors,
    view: view,
    history: {
      checkpoints: [],
      needsReloading: false
    },
    isLoaded: false,
    highlightings: [],
    goals: [],
    connection: undefined,
    runningInfo: RunningInfo$AgdaMode.make(undefined),
    onDispatch: Event$AgdaMode.make(undefined),
    onConnectionError: Event$AgdaMode.make(undefined)
  };
  var destructor1 = Curry._1(instance.view.onMouseEvent.on, (function (ev) {
          switch (ev.TAG | 0) {
            case /* JumpToTarget */0 :
                TaskRunner$AgdaMode.dispatchCommand({
                      TAG: 9,
                      _0: ev._0,
                      [Symbol.for("name")]: "Jump"
                    }, instance);
                return ;
            case /* MouseOver */1 :
            case /* MouseOut */2 :
                return ;
            
          }
        }));
  $$Promise.get(Curry._1(instance.view.onDestroy.once, undefined), (function (param) {
          return Curry._1(destructor1, undefined);
        }));
  return instance;
}

function dispatchUndo(instance) {
  instance.editors.source.undo();
  if (instance.history.needsReloading) {
    TaskRunner$AgdaMode.dispatchCommand(/* Load */0, instance);
    instance.history.needsReloading = false;
    return ;
  }
  
}

function getID(instance) {
  return Editors$AgdaMode.getID(instance.editors);
}

var $$Event;

var Goals;

var Highlightings;

var Connections;

var TextEditors;

exports.$$Event = $$Event;
exports.Goals = Goals;
exports.Highlightings = Highlightings;
exports.Connections = Connections;
exports.TextEditors = TextEditors;
exports.activate = activate;
exports.deactivate = deactivate;
exports.destroy = destroy;
exports.make = make;
exports.dispatchUndo = dispatchUndo;
exports.getID = getID;
/* Promise Not a pure module */
