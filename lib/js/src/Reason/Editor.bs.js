// Generated by BUCKLESCRIPT VERSION 4.0.17, PLEASE EDIT WITH CARE
'use strict';

var Block = require("bs-platform/lib/js/block.js");
var Curry = require("bs-platform/lib/js/curry.js");
var Rebase = require("@glennsl/rebase/lib/js/src/Rebase.bs.js");
var Caml_obj = require("bs-platform/lib/js/caml_obj.js");
var Caml_option = require("bs-platform/lib/js/caml_option.js");
var Hole$AgdaMode = require("./Hole.bs.js");
var Caml_exceptions = require("bs-platform/lib/js/caml_exceptions.js");
var MiniEditor$AgdaMode = require("./View/MiniEditor.bs.js");

var QueryCancelled = Caml_exceptions.create("Editor-AgdaMode.QueryCancelled");

function make(editor) {
  return /* record */Block.record([
            "focused",
            "source",
            "query"
          ], [
            0,
            editor,
            MiniEditor$AgdaMode.makeModel(/* () */0)
          ]);
}

function get(editor) {
  var match = editor[/* focused */0];
  if (match) {
    var match$1 = editor[/* query */2][/* ref */2];
    if (match$1 !== undefined) {
      return Caml_option.valFromOption(match$1);
    } else {
      return editor[/* source */1];
    }
  } else {
    return editor[/* source */1];
  }
}

function onSource(editor) {
  var match = editor[/* focused */0];
  if (match) {
    var element = atom.views.getView(editor[/* query */2]);
    element.focus();
    return /* () */0;
  } else {
    return /* () */0;
  }
}

function onQuery(editor) {
  var match = editor[/* focused */0];
  if (match) {
    return /* () */0;
  } else {
    var match$1 = editor[/* query */2][/* ref */2];
    if (match$1 !== undefined) {
      var element = atom.views.getView(Caml_option.valFromOption(match$1));
      element.focus();
      return /* () */0;
    } else {
      return /* () */0;
    }
  }
}

var Focus = /* module */Block.localModule([
    "get",
    "onSource",
    "onQuery"
  ], [
    get,
    onSource,
    onQuery
  ]);

function inquire(editor) {
  return Curry._1(editor[/* query */2][/* telePromise */3][/* wire */0], /* () */0);
}

function answer(editor) {
  return editor[/* query */2][/* telePromise */3][/* resolve */1];
}

function reject(editor) {
  return editor[/* query */2][/* telePromise */3][/* reject */2];
}

var Query = /* module */Block.localModule([
    "inquire",
    "answer",
    "reject"
  ], [
    inquire,
    answer,
    reject
  ]);

function destroy(index, self) {
  Rebase.$$Array[/* forEach */8](Hole$AgdaMode.destroy, Rebase.$$Array[/* filter */10]((function (x) {
              return Caml_obj.caml_equal(x[/* index */1], index);
            }), self));
  return Rebase.$$Array[/* filter */10]((function (x) {
                return Caml_obj.caml_notequal(x[/* index */1], index);
              }), self);
}

function destroyAll(self) {
  Rebase.$$Array[/* forEach */8](Hole$AgdaMode.destroy, self);
  return /* [] */0;
}

function find(index, self) {
  var result = Rebase.$$Array[/* filter */10]((function (x) {
          return Caml_obj.caml_equal(x[/* index */1], index);
        }), self);
  return Rebase.$$Array[/* get */17](result, 0);
}

function pointingAt(cursor, self) {
  var result = Rebase.$$Array[/* filter */10]((function (x) {
          return x[/* range */2].containsPoint(cursor, false);
        }), self);
  return Rebase.$$Array[/* get */17](result, 0);
}

var Goals = /* module */Block.localModule([
    "destroy",
    "destroyAll",
    "find",
    "pointingAt"
  ], [
    destroy,
    destroyAll,
    find,
    pointingAt
  ]);

var jsGoalsDestroy = destroy;

var jsGoalsDestroyAll = destroyAll;

var jsGoalsFind = find;

var jsGoalsPointingAt = pointingAt;

exports.QueryCancelled = QueryCancelled;
exports.make = make;
exports.Focus = Focus;
exports.Query = Query;
exports.Goals = Goals;
exports.jsGoalsDestroy = jsGoalsDestroy;
exports.jsGoalsDestroyAll = jsGoalsDestroyAll;
exports.jsGoalsFind = jsGoalsFind;
exports.jsGoalsPointingAt = jsGoalsPointingAt;
/* Hole-AgdaMode Not a pure module */
